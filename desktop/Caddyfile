# Caddy reverse proxy configuration for desktop access
# Routes:
#   /desktop/* → noVNC on host (port 6080)
#   /*         → nginx web container (port 80)
#
# Caddy listens on port 8080 to avoid conflict with nginx on port 80

:8080 {
    # Desktop/VNC access - proxy to noVNC running on host
    # noVNC serves at /vnc.html and needs WebSocket support
    handle_path /desktop/* {
        reverse_proxy localhost:6080 {
            # WebSocket support for VNC
            header_up Connection {>Connection}
            header_up Upgrade {>Upgrade}
        }
    }

    # Redirect /desktop to /desktop/vnc.html for convenience
    handle /desktop {
        redir /desktop/vnc.html permanent
    }

    # Everything else goes to nginx (also on localhost since we use host network)
    handle {
        reverse_proxy localhost:80
    }
}
